001180 IDENTIFICATION DIVISION.
001181 PROGRAM-ID. SMFLIST.
001182 AUTHOR. MATTHEW V. STITT.
001183 DATE-WRITTEN. 06/15/91.
001184 DATE-COMPILED.
001185 REMARKS. PRINT LISTING OF DATASET CREATED SMF RECORDS.
001186 ENVIRONMENT DIVISION.
001187 CONFIGURATION SECTION.
001188 SOURCE-COMPUTER. IBM-3081.
001189 OBJECT-COMPUTER. IBM-3081.
001190 SPECIAL-NAMES.
001200     C01 IS TO-CHAN-1.
001300 INPUT-OUTPUT SECTION.
001400 FILE-CONTROL.
001500     SELECT SMF-DATA ASSIGN TO UT-S-SYS004.
001600     SELECT REPORT-OUT ASSIGN TO UT-S-SYS019.
001800     SELECT SMF-REC-TYPE61 ASSIGN TO UT-S-SORTWK01.
001900 DATA DIVISION.
002000 FILE SECTION.
002010 FD  SMF-DATA
002020     RECORDING MODE IS S
002030     BLOCK CONTAINS 32760 CHARACTERS
002040     RECORD CONTAINS 0 CHARACTERS
002050     LABEL RECORDS ARE STANDARD.
002600 01  SMF-FILE-A                  PIC X(20).
002610 01  SMF-FILE                    PIC X(32752).
004300 FD  REPORT-OUT
004301     RECORDING MODE IS F
004310     LABEL RECORDS ARE OMITTED.
004320 01  PRINT-LINE.
004400     02  P-LINE                  PIC X(133).
004500 SD  SMF-REC-TYPE61.
004600 01  SORT-RECORD.
004700     02  SMF61SYS                PIC X.
004701     02  SMF61RTY                PIC X.
004710     02  SMF-TIME                PIC S9(8)  COMP.
004800     02  SMF-DATE                PIC 9(7)   COMP-3.
004900     02  SMF-SID                 PIC X(4).
004910     02  SMF61SBS                PIC X(4).
004911     02  SMF61SUB                PIC X(2).
004920     02  SMF61POF                PIC 9(8)   COMP.
004930     02  SMF61PLN                PIC 9(4)   COMP.
004940     02  SMF61PNO                PIC 9(4)   COMP.
004950     02  SMF61DOF                PIC 9(8)   COMP.
004960     02  SMF61DLN                PIC 9(4)   COMP.
004970     02  SMF61DNO                PIC 9(4)   COMP.
005000     02  SMF-TYPE61.
005100         03  SMF61VER            PIC X(2).
005101         03  SMF61PNM            PIC X(8).
005110         03  SMF61JNM            PIC X(8).
005200         03  SMF61RST            PIC S9(8)  COMP.
005300         03  SMF61RDT            PIC 9(7)   COMP-3.
005400         03  SMF61UID            PIC X(8).
005600         03  SMF61FNC            PIC X.
005700         03  SMF61CNM            PIC X(44).
005710         03  SMF61TYP            PIC X.
005800         03  SMF61ENM            PIC X(44).
005810         03  SMF61NNM            PIC X(44).
010200 WORKING-STORAGE SECTION.
010300 77  WS-START                    PIC X(36)  VALUE
010400     'SMFLIST  WORKING STORAGE STARTS HERE'.
010500 77  WORK-CHAR                   PIC X.
010600 77  AB-CODE                     PIC S9(3)  COMP    VALUE ZERO.
010700 77  WORK-BIT-EXPAND             PIC S9(5)  COMP-3  VALUE ZERO.
010800 77  WORK-JUL                    PIC 9(5).
010900 77  WORK-JUL-1                  PIC 9(5).
011000 77  WORK-JUL-2                  PIC 9(5).
011100 77  JUL-DIFF                    PIC S9(5)  COMP-3.
011200 77  G207-FUNC14                 PIC XX     VALUE '14'.
011210 77  G207-FUNC34                 PIC XX     VALUE '34'.
011300 77  PREV-SUBSYS                 PIC X(4).
011400 77  PREV-SUBTYP                 PIC S9(4)  COMP    VALUE ZERO.
011500 77  PREV-TIME                   PIC S9(8)  COMP    VALUE ZERO.
011600 77  PREV-DATE                   PIC 9(7)   COMP-3  VALUE ZERO.
011610 77  PAGE-CNT                    PIC 9(7)   COMP-3  VALUE ZERO.
011620 77  LINE-COUNT                  PIC 9(7)   COMP-3  VALUE ZERO.
011700 77  FIRST-REPORT-SW             PIC 9              VALUE ZERO.
011800 77  SMF61-NU-EXT                PIC S9(8)  COMP.
011900 77  SMF61BLK                    PIC S9(8)  COMP.
012000 77  W                           PIC 9.
012100 77  X                           PIC S9(8)  COMP.
012200 77  Y                           PIC S9(8)  COMP.
012300 77  Z                           PIC S9(8)  COMP.
012400 01  SMF-RECORD.
012500*    02  REC-LEN                 PIC XX.
012600*    02  SEG-DESC                PIC XX.
012700     02  SYS-IND                 PIC X.
012800     02  REC-TYPE                PIC X.
012900     02  REC-TIME                PIC S9(8)  COMP.
013000     02  REC-DATE                PIC 9(7)   COMP-3.
013100     02  SYS-IDENT               PIC X(4).
013110     02  SYS-RESERVE             PIC X(6).
013120     02  SYS-PROD-OFF            PIC 9(8)   COMP.
013130     02  SYS-PROD-LEN            PIC 9(4)   COMP.
013140     02  SYS-PROD-NO             PIC 9(4)   COMP.
013150     02  SYS-DATA-OFF            PIC 9(8)   COMP.
013160     02  SYS-DATA-LEN            PIC 9(4)   COMP.
013170     02  SYS-DATA-NO             PIC 9(4)   COMP.
013200     02  SMF-DATA-REC            PIC X(32760).
013300 01  D-TIME.
013400     02  D-HH                    PIC 99.
013500     02  FILLER                  PIC X      VALUE '.'.
013600     02  D-MM                    PIC 99.
013700     02  FILLER                  PIC X      VALUE '.'.
013800     02  D-SS                    PIC 99.
013900 01  TYPE61-DATA.
014000     02  TYPE61-BASIC            PIC X(32756).
017700 01  HEAD-1.
017800     02  FILLER                  PIC X     VALUE SPACE.
017900     02  HEAD-PROGRAM            PIC X(8)  VALUE SPACE.
018000     02  FILLER                  PIC X(47) VALUE SPACE.
018100     02  FILLER                  PIC X(22) VALUE
018200         'ABC DISTRIBUTING, LLC.'.
018300     02  FILLER                  PIC X(45) VALUE SPACE.
018400     02  FILLER                  PIC X(5)  VALUE 'PAGE '.
018500     02  HEAD-PAGE               PIC ZZZZ9 VALUE ZERO.
018600 01  HEAD-2.
018700     02  FILLER                  PIC X     VALUE SPACE.
018800     02  FILLER                  PIC X(5)  VALUE 'DATE '.
018900     02  HEAD-DATE               PIC X(10) VALUE SPACE.
019000     02  FILLER                  PIC X(11) VALUE SPACE.
019100     02  HEAD-SYS-DESC           PIC X(80) VALUE SPACE.
019200 01  HEAD-3.
019300     02  FILLER                  PIC X     VALUE SPACE.
019400     02  FILLER                  PIC X(51) VALUE SPACE.
019500     02  HEAD-SEQ                PIC X(30) VALUE SPACE.
019600 01  HEAD-4.
019700     02  FILLER                  PIC X(2)  VALUE SPACE.
019800     02  FILLER                  PIC X(3)  VALUE 'JOB'.
019900     02  FILLER                  PIC X(7)  VALUE SPACE.
020000     02  FILLER                  PIC X(4)  VALUE 'FILE'.
020100     02  FILLER                  PIC X(6)  VALUE SPACE.
020200     02  FILLER                  PIC X(7)  VALUE 'DATASET'.
020300     02  FILLER                  PIC X(39) VALUE SPACE.
020400     02  FILLER                  PIC X(4)  VALUE 'UNIT'.
020500     02  FILLER                  PIC X(2)  VALUE SPACE.
020600     02  FILLER                  PIC X(6)  VALUE 'VOLUME'.
020700     02  FILLER                  PIC X(3)  VALUE SPACE.
020800     02  FILLER                  PIC X(3)  VALUE 'END'.
020900     02  FILLER                  PIC X(8)  VALUE SPACE.
021000     02  FILLER                  PIC X(3)  VALUE 'END'.
021100     02  FILLER                  PIC X(12) VALUE SPACE.
021200     02  FILLER                  PIC X(5)  VALUE 'BLOCK'.
021300 01  HEAD-5.
021400     02  FILLER                  PIC X(2)  VALUE SPACE.
021500     02  FILLER                  PIC X(4)  VALUE 'NAME'.
021600     02  FILLER                  PIC X(6)  VALUE SPACE.
021700     02  FILLER                  PIC X(4)  VALUE 'NAME'.
021800     02  FILLER                  PIC X(6)  VALUE SPACE.
021900     02  FILLER                  PIC X(4)  VALUE 'NAME'.
022000     02  FILLER                  PIC X(42) VALUE SPACE.
022100     02  FILLER                  PIC X(4)  VALUE 'ADDR'.
022200     02  FILLER                  PIC X(3)  VALUE SPACE.
022300     02  FILLER                  PIC X(4)  VALUE 'NAME'.
022400     02  FILLER                  PIC X(4)  VALUE SPACE.
022500     02  FILLER                  PIC X(4)  VALUE 'DATE'.
022600     02  FILLER                  PIC X(7)  VALUE SPACE.
022700     02  FILLER                  PIC X(4)  VALUE 'TIME'.
022800     02  FILLER                  PIC X(11) VALUE SPACE.
022900     02  FILLER                  PIC X(5)  VALUE 'COUNT'.
023000 01  DETAIL-LINE.
023100     02  FILLER                  PIC X(2).
023200     02  D-JOB-NAME              PIC X(8).
023300     02  FILLER                  PIC X(2).
023400     02  D-FILE-NAME             PIC X(8).
023500     02  FILLER                  PIC X(2).
023600     02  D-DATASET-NAME          PIC X(44).
023700     02  FILLER                  PIC X(2).
023800     02  D-UNIT-ADDR.
023900         03  D-ADDR-1            PIC X.
024000         03  D-ADDR-2            PIC X.
024100         03  D-ADDR-3            PIC X.
024200         03  D-ADDR-4            PIC X.
024300     02  FILLER                  PIC X(2).
024400     02  D-VOL-SER               PIC X(6).
024500     02  FILLER                  PIC X(2).
024600     02  D-END-DATE              PIC X(10).
024700     02  FILLER                  PIC X(2).
024800     02  D-END-TIME              PIC X(8).
024900     02  FILLER                  PIC X(1).
025000     02  D-BLK-CNT               PIC Z(15).
025100 01  WORK-BINARY                 PIC 9(8)  COMP.
025200 01  BINARY-WORK             REDEFINES WORK-BINARY
025300                                 PIC XXXX.
025400 01  BINARY-WORK-1           REDEFINES WORK-BINARY.
025500     02  FILLER                  PIC XXX.
025600     02  BINARY-ONE              PIC X.
025700 01  BINARY-WORK-2           REDEFINES WORK-BINARY.
025800     02  FILLER                  PIC XX.
025900     02  BINARY-TWO              PIC XX.
026000 01  BINARY-WORK-3           REDEFINES WORK-BINARY.
026100     02  FILLER                  PIC X.
026200     02  BINARY-THREE            PIC XXX.
026300 01  BINARY-WORK-4           REDEFINES WORK-BINARY.
026400     02  BINARY-FOUR             PIC X(4).
026600 01  EXPAND-BYTE.
026700     02  BIT-ZERO                PIC X.
026800     02  BIT-ONE                 PIC X.
026900     02  BIT-TWO                 PIC X.
027000     02  BIT-THREE               PIC X.
027100     02  BIT-FOUR                PIC X.
027200     02  BIT-FIVE                PIC X.
027300     02  BIT-SIX                 PIC X.
027400     02  BIT-SEVEN               PIC X.
027500 01  WORK-ARRAY-ONE.
027600     02  ARRAY-ONE           OCCURS 32760 TIMES  INDEXED BY A1.
027700         03  CHAR-ONE            PIC X.
027800 01  WORK-ARRAY-TWO.
027900     02  ARRAY-TWO           OCCURS 32760 TIMES  INDEXED BY A2.
028000         03  CHAR-TWO            PIC X.
028100 PROCEDURE DIVISION.
028200     SORT SMF-REC-TYPE61 ASCENDING SMF-DATE, SMF-TIME
028300         INPUT PROCEDURE IS SELECT-RECORDS
028400         OUTPUT PROCEDURE IS PRINT-REPORT.
028500 FINISH-JOB.
028600     GOBACK.
028700*****************************************************************
028800*  THIS ROUTINE WILL FORMAT A BINARY BYTE (EIGHT BITS) INTO     *
028900*  EIGHT BYTES WITH THE BIT ON AND OFF REPRESENTATION IN EACH   *
029000*  BYTE.  THE BINARY BYTE IS PUT INTO FIELD WORK-CHAR AND THE   *
029100*  EIGHT BYTES ARE RETURNED IN FIELD EXPAND-BYTE.  THE FOUR     *
029200*  BYTE FIELDS WORK-BINARY ARE USED HEAVILY IN THIS ROUTINE     *
029300*****************************************************************
029400 EXPAND-BITS.
029500     MOVE LOW-VALUES TO BINARY-WORK.
029600     MOVE WORK-CHAR TO BINARY-ONE.
029700     COMPUTE WORK-BIT-EXPAND = WORK-BINARY.
029800     MOVE ALL ZERO TO EXPAND-BYTE.
029900     SUBTRACT 128 FROM WORK-BIT-EXPAND.
030000     IF WORK-BIT-EXPAND LESS THAN ZERO
030100         MOVE '0' TO BIT-ZERO
030200         ADD 128 TO WORK-BIT-EXPAND
030300       ELSE MOVE '1' TO BIT-ZERO.
030400     SUBTRACT 065 FROM WORK-BIT-EXPAND.
030500     IF WORK-BIT-EXPAND LESS THAN ZERO
030600         MOVE '0' TO BIT-ONE
030700         ADD 065 TO WORK-BIT-EXPAND
030800       ELSE MOVE '1' TO BIT-ONE.
030900     SUBTRACT 032 FROM WORK-BIT-EXPAND.
031000     IF WORK-BIT-EXPAND LESS THAN ZERO
031100         MOVE '0' TO BIT-TWO
031200         ADD 032 TO WORK-BIT-EXPAND
031300       ELSE MOVE '1' TO BIT-TWO.
031400     SUBTRACT 016 FROM WORK-BIT-EXPAND.
031500     IF WORK-BIT-EXPAND LESS THAN ZERO
031600         MOVE '0' TO BIT-THREE
031700         ADD 016 TO WORK-BIT-EXPAND
031800       ELSE MOVE '1' TO BIT-THREE.
031900     SUBTRACT 008 FROM WORK-BIT-EXPAND.
032000     IF WORK-BIT-EXPAND LESS THAN ZERO
032100         MOVE '0' TO BIT-FOUR
032200         ADD 008 TO WORK-BIT-EXPAND
032300       ELSE MOVE '1' TO BIT-FOUR.
032400     SUBTRACT 004 FROM WORK-BIT-EXPAND.
032500     IF WORK-BIT-EXPAND LESS THAN ZERO
032600         MOVE '0' TO BIT-FIVE
032700         ADD 004 TO WORK-BIT-EXPAND
032800       ELSE MOVE '1' TO BIT-FIVE.
032900     SUBTRACT 002 FROM WORK-BIT-EXPAND.
033000     IF WORK-BIT-EXPAND LESS THAN ZERO
033100         MOVE '0' TO BIT-SIX
033200         ADD 002 TO WORK-BIT-EXPAND
033300       ELSE MOVE '1' TO BIT-SIX.
033400     SUBTRACT 001 FROM WORK-BIT-EXPAND.
033500     IF WORK-BIT-EXPAND LESS THAN ZERO
033600         MOVE '0' TO BIT-SEVEN
033700         ADD 001 TO WORK-BIT-EXPAND
033800       ELSE MOVE '1' TO BIT-SEVEN.
033900 TRANSFER-DATA.
034000     MOVE ZERO TO X.
034100     SET A2 TO X.
034200     MOVE LOW-VALUES TO WORK-ARRAY-TWO.
034300 TRANSFER-LOOP.
034400     SET A2 UP BY 1.
034500     IF A2 > Y
034600         GO TO END-TRANSFER-LOOP.
034700     SET A1 UP BY 1.
034800     MOVE CHAR-ONE (A1) TO CHAR-TWO (A2).
034900     GO TO TRANSFER-LOOP.
035000 END-TRANSFER-LOOP.
035100     EXIT.
035200 NEW-REPORT-SETUP.
036600     OPEN OUTPUT REPORT-OUT.
036700 SELECT-RECORDS SECTION.
036800     OPEN INPUT SMF-DATA.
036900 READ-FILE.
037000     MOVE LOW-VALUES TO SMF-RECORD.
037100     READ SMF-DATA INTO SMF-RECORD AT END
037200         GO TO END-SELECT.
037300     MOVE REC-TYPE TO WORK-CHAR.
037400     MOVE LOW-VALUES TO BINARY-WORK.
037500     MOVE WORK-CHAR TO BINARY-ONE.
037600     COMPUTE WORK-BIT-EXPAND = WORK-BINARY.
037700     IF WORK-BIT-EXPAND NOT = 61
037800         GO TO READ-FILE.
038100*    MOVE LOW-VALUES TO WORK-ARRAY-ONE.
038200*    MOVE SMF-RECORD TO WORK-ARRAY-ONE.
040510 MOVE-DATA.
040520*    MOVE ZERO TO X.
040530*    SET A1 TO X.
040531*    MOVE 208 TO Y.
040560 DATA-LOOP.
040570*    PERFORM TRANSFER-DATA THROUGH END-TRANSFER-LOOP.
040571     MOVE SMF-RECORD TO SORT-RECORD.
040572*    MOVE WORK-ARRAY-TWO TO TYPE61-BASIC.
040573*    MOVE REC-DATE TO SMF-DATE.
040574*    MOVE REC-TIME TO SMF-TIME.
040575*    MOVE TYPE61-BASIC TO SMF-TYPE61.
040593     RELEASE SORT-RECORD.
040594     GO TO READ-FILE.
040600 END-SELECT.
040700     CLOSE SMF-DATA.
040800 END-SELECT-EXIT.
040900     EXIT.
041000 PRINT-REPORT SECTION.
041400     MOVE 'SMFLIST ' TO HEAD-PROGRAM.
041500     MOVE 'SYSTEM MEASUREMENT FACILITY -- FILE DEFINES'
041600         TO HEAD-SYS-DESC.
041700     MOVE 'AS GIVEN ON DATA FILE' TO HEAD-SEQ.
041800     CALL 'G207DCAN' USING G207-FUNC14, HEAD-DATE.
041900     PERFORM NEW-REPORT-SETUP.
042000     PERFORM PRINT-HEADINGS-ROUTINE THROUGH PRINT-EXIT.
042100     GO TO GET-SMF-DATA.
042200 PRINT-HEADINGS-ROUTINE.
042210     ADD 1 TO PAGE-CNT
042220     MOVE PAGE-CNT TO HEAD-PAGE.
042230     MOVE HEAD-1 TO PRINT-LINE.
042240     WRITE PRINT-LINE AFTER ADVANCING TO-CHAN-1.
042250     MOVE HEAD-2 TO PRINT-LINE.
042260     WRITE PRINT-LINE AFTER ADVANCING 1 LINES.
042270     MOVE HEAD-3 TO PRINT-LINE.
042280     WRITE PRINT-LINE AFTER ADVANCING 1 LINES.
042290     MOVE HEAD-4 TO PRINT-LINE.
042291     WRITE PRINT-LINE AFTER ADVANCING 2 LINES.
042292     MOVE HEAD-5 TO PRINT-LINE.
042293     WRITE PRINT-LINE AFTER ADVANCING 1 LINES.
042294     MOVE SPACE TO PRINT-LINE.
042295     MOVE ZERO TO LINE-COUNT.
042296 PRINT-1.
042297     WRITE PRINT-LINE AFTER ADVANCING 1 LINES.
042298     ADD 1 TO LINE-COUNT.
042299     IF LINE-COUNT > 56
042300         PERFORM PRINT-HEADINGS-ROUTINE.
042301 PRINT-EXIT.
042302     EXIT.
042310 GET-SMF-DATA.
042400     RETURN SMF-REC-TYPE61 AT END
042500         GO TO FINISH-REPORT.
042510     IF SMF61JNM = SPACE OR LOW-VALUES
042520         GO TO GET-SMF-DATA.
042530     IF SMF61ENM = SPACE OR LOW-VALUES
042540         GO TO GET-SMF-DATA.
042600     MOVE SPACE TO DETAIL-LINE.
042700     MOVE SMF61JNM TO D-JOB-NAME.
042800     DIVIDE SMF-TIME BY 100 GIVING X.
042900     DIVIDE X BY 3600 GIVING D-HH
043000         REMAINDER Y.
043100     DIVIDE Y BY 60 GIVING D-MM
043200         REMAINDER D-SS.
043300     MOVE D-TIME TO D-END-TIME.
043400     MOVE SMF-DATE TO WORK-JUL.
043500     MOVE WORK-JUL TO WORK-JUL-1.
043600     CALL 'G207DCAN' USING G207-FUNC34, WORK-JUL D-END-DATE.
043800     MOVE SMF61ENM TO D-DATASET-NAME.
055600     MOVE DETAIL-LINE TO P-LINE.
055700     PERFORM PRINT-1 THROUGH PRINT-EXIT.
055800     GO TO GET-SMF-DATA.
055900 FINISH-REPORT.
056000     CLOSE REPORT-OUT.
056100 PRINT-REPORT-EXIT.
056200     EXIT.
